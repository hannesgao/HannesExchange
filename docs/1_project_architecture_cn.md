# 项目架构概述
本项目实现了一个高级、安全且支持升级的自动化做市商（AMM）平台采用 **UUPS（可升级代理模式）** 实现逻辑和存储分离，并优化 Gas 使用效率，同时添加了多层次的安全机制，包括滑点控制、紧急停止功能和基于角色的权限管理  

本项目的架构参考了Uniswap V2的Codebase，并在其基础上添加了上述新特性

---

## 模块说明

### 核心接口
- **ICallee**：合约调用者（用户）接口
- **IERC20**：ERC20 标准代币接口
- **IFactory**：流动性池工厂接口，用于创建流动性池
- **IPair**：单一流动性池的接口，支持 ETH 与 ERC20 代币交换

### 核心合约
#### **Factory**
- 创建和管理多个流动性池
- 记录所有流动性池地址，支持通过代币对查询对应池

#### **Pair**
- 单个流动性池合约，支持代币交换和流动性管理
- 实现滑点控制、手续费奖励机制和动态定价
- 通过 **AccessControlUpgradeable** 管理权限

---

## 安全机制
1. **防范重入攻击**：使用 OpenZeppelin 的 `nonReentrant` 修饰符
2. **紧急停止功能**：使用 OpenZeppelin 的 `PausableUpgradeable` 
3. **Gas 优化**：减少状态变量更新操作，精简事件日志
4. **升级管理**：通过 `UPGRADER_ROLE` 限制升级权限

---

## 存储与逻辑分离
通过 **UUPS** 模式实现存储和逻辑分离，存储变量保存在 Proxy 中，而逻辑存储在实现合约中升级流程如下：

### 初始化存储
- Proxy 的构造函数指定初始逻辑合约
- 调用 `initialize` 方法完成角色分配和初始设置

### 替换逻辑
- 新逻辑合约通过 `upgradeTo` 方法部署至 Proxy
- 保证 Proxy 的存储变量完整性